# Руководство по тестированию приложения Todo

В данном документе описаны инструкции по запуску тестов приложения с использованием PostgreSQL и Testcontainers.

## Подготовка окружения

Перед запуском тестов необходимо:

1. Установить Docker на машине для разработки
2. Добавить необходимые зависимости в файл `pom.xml` (см. файл `test-dependencies.txt`)
3. Создать файл `application-test.properties` в папке `src/test/resources`

## Запуск тестов с использованием Testcontainers

Тесты используют Testcontainers для автоматического запуска и остановки PostgreSQL в контейнере:

1. Убедитесь, что Docker запущен на вашем компьютере

2. Просто запустите тесты как обычно:
   ```bash
   ./mvnw test
   ```

Testcontainers автоматически:
- Запустит контейнер PostgreSQL перед выполнением тестов
- Настроит соединение с базой данных
- Остановит и удалит контейнер после выполнения тестов

Весь процесс организован через класс `BaseIntegrationTest`, от которого наследуются все интеграционные тесты:

## Структура тестов

В проекте реализованы следующие группы тестов:

1. **Репозитории** - тесты для слоя доступа к данным:
    - `UserRepositoryTest`
    - `TodoRepositoryTest`

2. **Сервисы** - тесты бизнес-логики:
    - `UserServiceTest`
    - `TodoServiceTest`

3. **Контроллеры** - интеграционные тесты REST API:
    - `UserControllerIntegrationTest`
    - `TodoControllerIntegrationTest`

4. **Безопасность** - тесты конфигурации безопасности:
    - `SecurityConfigTest`
    - `WebSecurityConfigTest`

5. **Обработка ошибок** - тесты глобального обработчика исключений:
    - `GlobalExceptionHandlerTest`

## Важные замечания

- Тесты настроены для использования реальной базы данных PostgreSQL вместо встроенной базы данных
- В тестах используется режим `create-drop` для схемы базы данных, что означает, что схема будет создаваться перед каждым запуском тестов и удаляться после
- Убедитесь, что порт 5432 свободен или измените порт в файле `docker-compose-test.yml`